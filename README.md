# Dose instructions named entity recognition 

* This repository contains development code for parsing redacted dose instructions. 
* It will replace the [parseRx](https://phs-git.nhsnss.scot.nhs.uk/eDRIS/parseRx) code, written in prolog.
* It is written primarily in python, and consists of named entity recognition(NER) via the [spacy](https://spacy.io) package
* The output model is generated by starting with the existing [med7](https://www.sciencedirect.com/science/article/abs/pii/S0933365721000798) [model](https://huggingface.co/kormilitzin/en_core_med7_lg/tree/main) and further training this using examples specific to the prescribing information system data

## File layout

* example
    * `example.py` is an example of how to apply the med7 model to some test data
* preprocess
    * for_tagging
        * Contains data that needs tagged
        * for_processing
            * Contains data that needs processed before it is ready for tagging
    * tagged
        * Contains data that has been tagged
    * `parse_prolog_test_data.py` contains code for parsing the test data from the parseRx prolog code into a format that can be used for tagging
    * `sample_diabetes_study.py` contains code for obtaining a random 2% sample of redacted dose instructions data from the diabetes update study (2223-0181) and outputting this to a text file for tagging using the online [NER annotator tool](https://tecoholic.github.io/ner-annotator/) 
    * `preprocess.py` contains code for reading in .json files produced by the annotator tool, amalgamating them and then creating spacy training and validation data for developing the existing model
* config
    * Contains configuration files for running spacy
* data
    * Contains `train.spacy` and `valid.spacy` training and validation data produced by `preprocess.py`
* `train_model.sh` 
    * Executable for training the model based off info in *config* and *data*
